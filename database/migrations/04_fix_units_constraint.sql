-- ==========================================================
-- ИСПРАВЛЕНИЕ ОГРАНИЧЕНИЙ ДЛЯ ТАБЛИЦЫ UNITS
-- ==========================================================
-- Проблема: Сейчас таблица 'units' скорее всего имеет ограничение UNIQUE(name),
-- что не позволяет разным пользователям создавать единицы с одинаковым названием (например, "кг").
--
-- Решение: Заменить ограничение на UNIQUE(name, user_id), чтобы у каждого пользователя
-- был СВОЙ набор единиц.

-- 1. Сначала удаляем старое ограничение (по имени, если оно есть)
-- Примечание: Мы пытаемся угадать имя констрейнта. Обычно это units_name_key.
ALTER TABLE units DROP CONSTRAINT IF EXISTS units_name_key;

-- 2. Если имя констрейнта другое, можно попробовать удалить индекс напрямую
DROP INDEX IF EXISTS units_name_idx;

-- 3. Добавляем новое правильное ограничение: Имя уникально только в рамках одного пользователя
ALTER TABLE units 
ADD CONSTRAINT units_name_user_id_key UNIQUE (name, user_id);

-- 4. Теперь каждый пользователь может иметь свой 'кг', 'л' и т.д.
